---
phase: 03-isolines-interactivity
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [components/portfolio/fluid-background.tsx]
autonomous: true

must_haves:
  truths:
    - "Mouse position is tracked smoothly without jitter"
    - "Mouse uniform updates at 60fps in animation loop"
    - "Mouse movement does not degrade animation performance"
  artifacts:
    - path: "components/portfolio/fluid-background.tsx"
      provides: "Mouse tracking infrastructure with lerped uniforms"
      contains: "uMouse"
  key_links:
    - from: "pointermove event"
      to: "targetMouse Vector2"
      via: "event handler updates target"
      pattern: "handlePointerMove"
    - from: "animation loop"
      to: "uniforms.uMouse"
      via: "currentMouse.lerp(targetMouse)"
      pattern: "currentMouse\\.lerp"
---

<objective>
Add mouse tracking infrastructure to FluidBackground shader.

Purpose: Enable future mouse-based distortion by providing smoothed mouse position uniform
Output: uMouse and uMouseInfluence uniforms updating in animation loop with lerp smoothing
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/03-isolines-interactivity/03-RESEARCH.md
@components/portfolio/fluid-background.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mouse uniforms and tracking infrastructure</name>
  <files>components/portfolio/fluid-background.tsx</files>
  <action>
Add mouse tracking to the existing FluidBackground component:

1. Add two new uniforms to the uniforms object:
   - `uMouse: { value: new THREE.Vector2(0.5, 0.5) }` - normalized 0-1 coordinates
   - `uMouseInfluence: { value: 0.03 }` - 3% influence strength

2. Declare mouse tracking vectors after uniforms:
   - `const targetMouse = new THREE.Vector2(0.5, 0.5)`
   - `const currentMouse = new THREE.Vector2(0.5, 0.5)`

3. Create handlePointerMove function:
   - Get container bounding rect
   - Normalize X: `(event.clientX - rect.left) / rect.width`
   - Normalize Y with flip: `1.0 - ((event.clientY - rect.top) / rect.height)`
   - Update targetMouse with these values

4. Add event listener with passive: true:
   - `container.addEventListener('pointermove', handlePointerMove, { passive: true })`

5. Update animation loop to lerp mouse:
   - Add before render: `currentMouse.lerp(targetMouse, 0.1)`
   - Add after lerp: `uniforms.uMouse.value.copy(currentMouse)`

6. Add cleanup for event listener in return function:
   - `container.removeEventListener('pointermove', handlePointerMove)`

7. Add uniform declarations to fragment shader (but don't use them yet):
   - `uniform vec2 uMouse;`
   - `uniform float uMouseInfluence;`

Note: The shader does not use these uniforms yet - that's Plan 03-02.
  </action>
  <verify>
Run dev server at localhost:3000. Open browser console. Add temporary log in animate():
`console.log(uniforms.uMouse.value.x.toFixed(2), uniforms.uMouse.value.y.toFixed(2))`
Move mouse over component - values should smoothly interpolate toward cursor position (0-1 range).
Values should NOT jump suddenly. Build should pass: `bun run build`
  </verify>
  <done>
Mouse uniform updates smoothly in animation loop. Event listener registered with passive: true.
Cleanup removes event listener. Fragment shader declares uniforms (but doesn't use them yet).
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify mouse tracking performance</name>
  <files>components/portfolio/fluid-background.tsx</files>
  <action>
Test mouse tracking performance to ensure no degradation:

1. Open Chrome DevTools Performance tab
2. Record 5 seconds while moving mouse rapidly over component
3. Check frame rate stays at 60fps
4. Remove any temporary console.log statements added in Task 1

If performance issues detected:
- Ensure event handler only updates targetMouse (no other work)
- Verify lerp happens in animation loop, not event handler
- Check passive: true is set on event listener

Clean up any debug code before committing.
  </action>
  <verify>
Performance recording shows consistent 60fps during mouse movement.
No console.log statements in production code.
`bun run build` passes without errors.
  </verify>
  <done>
Animation maintains 60fps during mouse interaction.
No debug code remains.
Component ready for shader distortion implementation.
  </done>
</task>

</tasks>

<verification>
- [ ] Build passes: `bun run build`
- [ ] Dev server runs without errors
- [ ] Mouse position updates smoothly (lerp visible in values)
- [ ] Animation framerate stable at 60fps during mouse movement
- [ ] Event listener uses passive: true
- [ ] Cleanup properly removes event listener
</verification>

<success_criteria>
Mouse tracking infrastructure complete:
- uMouse uniform receives smoothed 0-1 coordinates
- uMouseInfluence uniform set to 0.03 (3%)
- Lerp factor 0.1 provides smooth tracking without lag
- No performance degradation during mouse interaction
- Shader declares uniforms (ready for Plan 03-02 to use them)
</success_criteria>

<output>
After completion, create `.planning/phases/03-isolines-interactivity/03-01-SUMMARY.md`
</output>
