---
phase: 03-isolines-interactivity
plan: 02
type: execute
wave: 2
depends_on: [03-01]
files_modified: [components/portfolio/fluid-background.tsx]
autonomous: true

must_haves:
  truths:
    - "8 topographic isolines are visible on screen"
    - "Lines have smooth anti-aliased edges"
    - "Mouse movement subtly distorts the blob field"
    - "Distortion is 2-5% influence, not obvious"
  artifacts:
    - path: "components/portfolio/fluid-background.tsx"
      provides: "8 isolines with mouse distortion"
      contains: "line8"
  key_links:
    - from: "uMouse uniform"
      to: "getNoiseField sampling"
      via: "mouseOffset added to uvAspect"
      pattern: "uvAspect \\+ mouseOffset"
    - from: "isoline function"
      to: "allLines accumulator"
      via: "8 isoline calls with nested max()"
      pattern: "max.*max.*line"
---

<objective>
Expand isolines from 3 to 8 and add mouse-based distortion to noise field.

Purpose: Complete topographic visual effect with subtle interactivity
Output: 8 anti-aliased isolines that respond subtly to mouse position
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/03-isolines-interactivity/03-RESEARCH.md
@.planning/phases/03-isolines-interactivity/03-01-SUMMARY.md
@components/portfolio/fluid-background.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Expand isolines from 3 to 8</name>
  <files>components/portfolio/fluid-background.tsx</files>
  <action>
Update fragment shader main() function to render 8 isolines:

1. Replace the existing 3 isoline calls with 8 calls using evenly spaced thresholds:
   ```glsl
   float line1 = isoline(noise, 0.20, 1.5);
   float line2 = isoline(noise, 0.30, 1.5);
   float line3 = isoline(noise, 0.40, 1.5);
   float line4 = isoline(noise, 0.50, 1.5);
   float line5 = isoline(noise, 0.60, 1.5);
   float line6 = isoline(noise, 0.70, 1.5);
   float line7 = isoline(noise, 0.80, 1.5);
   float line8 = isoline(noise, 0.90, 1.5);
   ```

2. Update allOutlines to combine all 8 lines using nested max():
   ```glsl
   float allLines = max(max(max(max(max(max(max(
     line1, line2), line3), line4), line5), line6), line7), line8);
   ```

3. Update the mix() call to use allLines instead of allOutlines:
   ```glsl
   color = mix(color, lineColor, allLines);
   ```

Keep the same line width (1.5) and colors as before.
  </action>
  <verify>
Run dev server. Visual check: 8 distinct contour lines should be visible.
Lines should be evenly distributed across the noise field.
Anti-aliasing should still work (smooth edges, no jaggies).
`bun run build` passes.
  </verify>
  <done>
8 topographic isolines render with anti-aliased edges.
Spacing is even (0.10 intervals from 0.20 to 0.90).
  </done>
</task>

<task type="auto">
  <name>Task 2: Add mouse distortion to noise field</name>
  <files>components/portfolio/fluid-background.tsx</files>
  <action>
Update fragment shader main() to distort noise sampling based on mouse position:

1. After calculating uvAspect, add mouse distortion calculation:
   ```glsl
   // Mouse distortion
   vec2 mouseAspect = vec2(uMouse.x * aspect, uMouse.y);
   float mouseDist = distance(uvAspect, mouseAspect);

   // Radial influence with smooth falloff (radius 0.3)
   float influence = smoothstep(0.3, 0.0, mouseDist);
   vec2 mouseOffset = (uvAspect - mouseAspect) * influence * uMouseInfluence;
   ```

2. Modify getNoiseField call to include mouse offset:
   - Change: `float noise = getNoiseField(uvAspect);`
   - To: `float noise = getNoiseField(uvAspect + mouseOffset);`

The distortion creates a subtle "push away" effect - blobs appear to be gently displaced from the mouse cursor.

uMouseInfluence is already set to 0.03 (3%) from Plan 03-01.
  </action>
  <verify>
Run dev server. Move mouse over component.
Visual check: Blobs should subtly shift/warp near cursor.
Effect should be noticeable but not distracting (subtle topographic shift).
Effect should be smooth without jitter (thanks to lerping from 03-01).
`bun run build` passes.
  </verify>
  <done>
Mouse movement creates subtle distortion of blob field.
Influence is 2-5% (uMouseInfluence = 0.03).
Distortion has smooth radial falloff (radius 0.3).
Effect is noticeable but not distracting.
  </done>
</task>

<task type="auto">
  <name>Task 3: Fine-tune and verify complete effect</name>
  <files>components/portfolio/fluid-background.tsx</files>
  <action>
Test the complete implementation and make minor adjustments if needed:

1. Visual verification checklist:
   - 8 isolines visible at different noise levels
   - Lines have smooth anti-aliased edges (no jaggies)
   - Mouse distortion is subtle (barely noticeable, not attention-grabbing)
   - Animation continues smoothly at 60fps

2. If mouse effect is too strong (distracting):
   - Reduce uMouseInfluence from 0.03 to 0.02

3. If mouse effect is too weak (invisible):
   - Increase uMouseInfluence from 0.03 to 0.04 (max 0.05)

4. If distortion area is too small:
   - Increase smoothstep radius from 0.3 to 0.4

5. Final cleanup:
   - Remove any debug code
   - Ensure no console.log statements
   - Run build to verify no errors
  </action>
  <verify>
Visual verification on localhost:3000:
- Count 8 distinct contour lines
- Lines are smooth (zoom in to verify no jaggies)
- Move mouse: subtle distortion visible but not distracting
- Move mouse rapidly: no jitter, smooth tracking
Performance: Animation stays at 60fps during interaction
Build: `bun run build` passes without errors
  </verify>
  <done>
All Phase 3 success criteria met:
- 8 topographic isolines visible
- Anti-aliased edges (smoothstep + fwidth)
- 2-5% mouse influence
- Smooth tracking without jitter
- 60fps maintained during interaction
  </done>
</task>

</tasks>

<verification>
- [ ] 8 isolines visible at thresholds 0.20, 0.30, 0.40, 0.50, 0.60, 0.70, 0.80, 0.90
- [ ] Lines have smooth anti-aliased edges (fwidth + smoothstep)
- [ ] Mouse movement distorts blobs subtly (2-5% influence)
- [ ] Mouse tracking is smooth without jitter (lerp factor 0.1)
- [ ] Animation maintains 60fps during mouse interaction
- [ ] Build passes: `bun run build`
</verification>

<success_criteria>
Phase 3 complete:
1. 8 topographic isolines render with anti-aliasing
2. Mouse distortion adds subtle interactivity
3. Effect matches landonorris.com style (organic, subtle, fluid)
4. Performance maintained at 60fps
</success_criteria>

<output>
After completion, create `.planning/phases/03-isolines-interactivity/03-02-SUMMARY.md`
</output>
