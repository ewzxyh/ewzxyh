---
phase: 04-performance-accessibility
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/portfolio/fluid-background.tsx
  - hooks/use-reduced-motion.ts
autonomous: true

must_haves:
  truths:
    - "Usuario com prefers-reduced-motion ativo ve versao estatica (sem animacao)"
    - "Mudanca de preferencia do sistema atualiza componente sem reload"
    - "Versao estatica mantem visual coerente (mesmo gradiente de fundo)"
  artifacts:
    - path: "hooks/use-reduced-motion.ts"
      provides: "Hook para detectar preferencia de reduced-motion"
      exports: ["useReducedMotion"]
    - path: "components/portfolio/fluid-background.tsx"
      provides: "Componente com conditional rendering baseado em reduced-motion"
      contains: "useReducedMotion"
  key_links:
    - from: "components/portfolio/fluid-background.tsx"
      to: "hooks/use-reduced-motion.ts"
      via: "import e uso do hook"
      pattern: "useReducedMotion"
    - from: "hooks/use-reduced-motion.ts"
      to: "window.matchMedia"
      via: "prefers-reduced-motion query"
      pattern: "prefers-reduced-motion"
---

<objective>
Implementar suporte a prefers-reduced-motion para usuarios que preferem animacoes reduzidas.

Purpose: Acessibilidade - usuarios com vestibular disorders ou motion sensitivity devem ver versao estatica do background sem animacao.
Output: Hook useReducedMotion + FluidBackground com conditional rendering para mostrar versao estatica quando preferencia ativa.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-performance-accessibility/04-RESEARCH.md

@components/portfolio/fluid-background.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useReducedMotion hook</name>
  <files>hooks/use-reduced-motion.ts</files>
  <action>
Create hook that detects prefers-reduced-motion preference:

```typescript
import { useEffect, useState } from "react"

export function useReducedMotion(): boolean {
  const [reducedMotion, setReducedMotion] = useState(false)

  useEffect(() => {
    const query = window.matchMedia("(prefers-reduced-motion: reduce)")
    setReducedMotion(query.matches)

    const handler = (e: MediaQueryListEvent) => setReducedMotion(e.matches)
    query.addEventListener("change", handler)
    return () => query.removeEventListener("change", handler)
  }, [])

  return reducedMotion
}
```

Key points:
- Initial state false (assume motion OK until client-side check)
- Listen for changes (user pode mudar preferencia mid-session)
- Cleanup listener on unmount
  </action>
  <verify>
File exists and exports useReducedMotion. TypeScript compiles without errors.
  </verify>
  <done>
Hook created at hooks/use-reduced-motion.ts, exportando funcao useReducedMotion que retorna boolean.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add reduced-motion support to FluidBackground</name>
  <files>components/portfolio/fluid-background.tsx</files>
  <action>
Modify FluidBackground to render static version when reduced-motion is active:

1. Import useReducedMotion hook at top of file:
   `import { useReducedMotion } from "@/hooks/use-reduced-motion"`

2. Inside FluidBackground component, call hook before useEffect:
   `const reducedMotion = useReducedMotion()`

3. Add conditional return BEFORE the useEffect hook (early return for static version):
```typescript
if (reducedMotion) {
  return (
    <div
      className={`overflow-hidden ${className}`}
      style={{
        isolation: "isolate",
        contain: "layout style paint",
        backgroundColor: "#F5F5F0",
      }}
    />
  )
}
```

The static fallback uses the same background color (#F5F5F0) as the animated version for visual consistency. No WebGL, no animation - just a solid color div.

4. Ensure the existing useEffect and return remain unchanged for the animated case.
  </action>
  <verify>
1. Run `bun run build` - should pass
2. Open DevTools > Rendering > Emulate CSS media feature prefers-reduced-motion: reduce
3. FluidBackground should show solid #F5F5F0 background without canvas
4. Disable emulation - should show animated version
  </verify>
  <done>
FluidBackground renderiza versao estatica (div com backgroundColor #F5F5F0) quando prefers-reduced-motion: reduce esta ativo. Versao animada aparece normalmente quando preferencia nao esta ativa.
  </done>
</task>

</tasks>

<verification>
- [ ] `bun run build` passa sem erros
- [ ] Com prefers-reduced-motion: reduce ativo, FluidBackground mostra div estatico
- [ ] Com prefers-reduced-motion normal, FluidBackground mostra animacao WebGL
- [ ] Mudar preferencia no sistema atualiza componente sem reload
</verification>

<success_criteria>
Usuario com prefers-reduced-motion: reduce ve background estatico (sem canvas WebGL, sem animacao). Usuario sem a preferencia ve animacao normal. Mudanca de preferencia reflete imediatamente no componente.
</success_criteria>

<output>
After completion, create `.planning/phases/04-performance-accessibility/04-01-SUMMARY.md`
</output>
